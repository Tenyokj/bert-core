**Testing Guide**

**TL;DR**
```bash
# Run all tests
npx hardhat test

# Run a single test file
npx hardhat test test/Vx.x.x/IdeaRegistryUpgradeable.fully.ts
```

**Requirements**
1. `node >= 22.10`
2. Install deps: `npm i`

**Test Structure**
1. `test/Vx.x.x/` - main test suites (unit, integration, edge)
2. `test/setup.ts` - shared Hardhat setup exports
3. `test/Vx.x.x/helpers.ts` - deployment helpers used across suites

**Common Commands**
1. Run all tests:
```bash
npx hardhat test
```

2. Run a single file:
```bash
npx hardhat test test/Vx.x.x/VotingSystemUpgradeable.fully.ts
```

3. Run a single test by grep:
```bash
npx hardhat test --grep "Upgradeability edge cases"
```

4. View test coverage:
```bash
npx hardhat test --coverage 
```

**Coverage Notes**
1. Coverage output is generated by `solidity-coverage` and written to `coverage/`.
2. Some upgrade or proxy patterns may show lower line coverage due to delegatecall behavior.
3. If coverage hangs, try `npx hardhat clean` and re-run.

**Core Test Suites**
1. `IdeaRegistryUpgradeable.fully.ts` - idea creation, status transitions, reviews, and edge cases
2. `VotingSystemUpgradeable.fully.ts` - round lifecycle, staking, voting, and winner resolution
3. `FundingPoolUpgradeable.fully.ts` - deposits, pool accounting, and distributions
4. `GrantManagerUpgradeable.fully.ts` - claim flow, distribution checks, and edge cases
5. `ReputationSystemUpgradeable.fully.ts` - reputation init and updates
6. `VoterProgressionUpgradeable.fully.ts` - progression thresholds and role grants
7. `Upgradeability.edge.ts` - proxy upgrade and storage preservation

**Local Node vs In-Process Network**
By default, `hardhat test` uses the in-process Hardhat network. You usually do not need `hardhat node` for tests.

If you want to run tests against a separate local node:
1. Start node:
```bash
npx hardhat node
```
2. Run tests with network override:
```bash
npx hardhat test --network localhost
```

**Troubleshooting**
1. If tests fail after a node restart, re-run without `--network localhost`.
2. If a mock contract is missing, run `npx hardhat compile` once.
3. Ensure you are not running scripts via `tsx` for Hardhat v3 projects.
